name: Deploy to OSS

on:
  workflow_run:
    workflows: ["Optimize resource pack"] 
    types:
      - completed

jobs:
  upload:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Download latest released pack
        uses: dsaltares/fetch-gh-release-asset@1.1.1
        with:
          file: pack.zip
          target: pack.zip
      - name: Rename pack file
        run: mv pack.zip pack-${{ github.run_number }}.zip
      - name: Upload to OSS
        uses: YangHanlin/oss-deployment-action@v1
        with:
          oss-endpoint: ${{ secrets.OSS_ENDPOINT }}
          oss-accesskey-id: ${{ secrets.ALIYUN_ACCESS_KEY_ID }}
          oss-accesskey-secret: ${{ secrets.ALIYUN_ACCESS_KEY_SECRET }}
          oss-path: oss://mimaru/assets/
          local-path: pack-${{ github.run_number }}.zip
        
        
        
  
